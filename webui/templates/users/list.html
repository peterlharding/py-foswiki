{% extends "base.html" %}
{% block content %}
<div class="page-header">
  <h1>Users</h1>
  <a href="/register" class="btn btn-primary btn-sm">+ New User</a>
</div>

<div class="card" style="padding:0;">
  <table>
    <thead>
      <tr>
        <th>Username</th>
        <th>Display name</th>
        <th>Email</th>
        <th>Admin</th>
        <th>Active</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td style="font-weight:500;">{{ u.username }}</td>
        <td style="color:var(--muted);">{{ u.display_name or '—' }}</td>
        <td style="color:var(--muted); font-size:.85rem;">{{ u.email }}</td>
        <td>
          <form method="post" action="/users/{{ u.username }}/toggle-admin" style="display:inline;">
            <button type="submit" class="btn btn-sm {{ 'btn-primary' if u.is_admin else 'btn-secondary' }}"
                    {% if u.username == user.username %}disabled title="Cannot change your own admin status"{% endif %}>
              {{ '✓ Admin' if u.is_admin else 'User' }}
            </button>
          </form>
        </td>
        <td>
          <form method="post" action="/users/{{ u.username }}/toggle-active" style="display:inline;">
            <button type="submit" class="btn btn-sm {{ 'btn-primary' if u.is_active else 'btn-secondary' }}"
                    {% if u.username == user.username %}disabled title="Cannot deactivate yourself"{% endif %}>
              {{ '✓ Active' if u.is_active else 'Disabled' }}
            </button>
          </form>
        </td>
        <td style="text-align:right; white-space:nowrap;">
          <a href="/users/{{ u.username }}/edit" class="btn btn-secondary btn-sm">Edit</a>
          <a href="/users/{{ u.username }}/reset-password" class="btn btn-secondary btn-sm">Reset pw</a>
          {% if u.username != user.username %}
          <form method="post" action="/users/{{ u.username }}/delete" style="display:inline;"
                onsubmit="return confirm('Delete user {{ u.username }}? This cannot be undone.')">
            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
          </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
